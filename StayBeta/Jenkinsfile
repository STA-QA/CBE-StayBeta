node {
       
  
    
    
  //  properties([parameters([choice(choices: ['TestSuite1.xml,TestSuite2.xml, TestSuite5.xml'], description: 'Select Which Suite You Wanna Run', name: 'TestsToRun')])])
     parameters {
        string(defaultValue: "TEST", description: 'What environment?', name: 'userFlag')
        choice(choices: ['US-EAST-1', 'US-WEST-2'], description: 'What AWS region?', name: 'region')
    }
    

stage ('Git Checkout'){
git "https://github.com/Kiranmaiadams/CBE-Automation"

}
stage ('Build Project'){
bat "mvn -f StayBeta/pom.xml clean"
}
 stage ('Run Test'){
bat "mvn -f StayBeta/pom.xml test"
}


stage ('Publish Report'){
publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: true, reportDir: 'StayBeta/Reports/', reportFiles: '1SourceReleaseReport.html', reportName: '1SourceReleaseReport', reportTitles: ''])
}
 stage('Email Notification') 
 {
                bat "del Reports.zip"
                echo "ZIP"
               zip zipFile: 'Reports.zip', archive: false, dir: 'C:/Program Files (x86)/Jenkins/workspace/CBE StayBeta Pipeline/StayBeta/Reports'
               echo "END - ZIP"
               emailext attachmentsPattern: 'Reports.zip', body: '${SCRIPT, template="groovy-html.template"}', 
                subject: "${env.JOB_NAME} - Build # ${env.BUILD_NUMBER} - Successful", 
                    mimeType: 'text/html',to: "qateam@statravel.com"
            
        }
    }
   

